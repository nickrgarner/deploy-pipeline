---
# Install dependencies for checkbox.io build jobs

- name: Ensures /etc/jenkins_jobs dir exists
  file: path=/etc/jenkins_jobs state=directory
  become: true

- name: Copy jenkins_job.ini to correct location
  template:
    src: /bakerx/jenkins_jobs.ini
    dest: /etc/jenkins_jobs/jenkins_jobs.ini
  become: true

- name: Install nodejs
  apt:
    pkg: nodejs
    state: present
  become: true

- name: Install mongodb
  apt:
    pkg: mongodb
    state: latest
  become: true

- name: Install pip3 for Mongo Collection Dependencies
  apt:
    pkg: python3-pip
    state: latest
  become: true

- name: Install jenkins-job-builder
  pip:
    name: jenkins-job-builder
    state: present

- name: Installing pymongo
  pip:
    name: pymongo
    state: latest
  become: true

- name: Create mongodb user
  mongodb_user:
    database: admin
    name: "{{mongo.MONGO_USER}}"
    password: "{{mongo.MONGO_PASSWORD}}"
    roles: readWrite
    state: present
  become: true
